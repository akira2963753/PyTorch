"use strict";(self.webpackChunkanytype_publish_renderer=self.webpackChunkanytype_publish_renderer||[]).push([["362"],{14804:function(e,t,r){r.d(t,{diagram:()=>ef});var i=r(35484),s=r(46831),o=r(18010),n=r(79068);r(68394);var a=r(89356),d=r(65830),l=r(3194),c=r(58446),f=r(44867),h=r(58199),p={L:"left",R:"right",T:"top",B:"bottom"},g={L:(0,d.eW)(e=>`${e},${e/2} 0,${e} 0,0`,"L"),R:(0,d.eW)(e=>`0,${e/2} ${e},0 ${e},${e}`,"R"),T:(0,d.eW)(e=>`0,0 ${e},0 ${e/2},${e}`,"T"),B:(0,d.eW)(e=>`${e/2},0 ${e},${e} 0,${e}`,"B")},u={L:(0,d.eW)((e,t)=>e-t+2,"L"),R:(0,d.eW)((e,t)=>e-2,"R"),T:(0,d.eW)((e,t)=>e-t+2,"T"),B:(0,d.eW)((e,t)=>e-2,"B")},y=(0,d.eW)(function(e){return k(e)?"L"===e?"R":"L":"T"===e?"B":"T"},"getOppositeArchitectureDirection"),m=(0,d.eW)(function(e){return"L"===e||"R"===e||"T"===e||"B"===e},"isArchitectureDirection"),k=(0,d.eW)(function(e){return"L"===e||"R"===e},"isArchitectureDirectionX"),x=(0,d.eW)(function(e){return"T"===e||"B"===e},"isArchitectureDirectionY"),w=(0,d.eW)(function(e,t){let r=k(e)&&x(t),i=x(e)&&k(t);return r||i},"isArchitectureDirectionXY"),b=(0,d.eW)(function(e){let t=e[0],r=e[1],i=k(t)&&x(r),s=x(t)&&k(r);return i||s},"isArchitecturePairXY"),$=(0,d.eW)(function(e){return"LL"!==e&&"RR"!==e&&"TT"!==e&&"BB"!==e},"isValidArchitectureDirectionPair"),v=(0,d.eW)(function(e,t){let r=`${e}${t}`;return $(r)?r:void 0},"getArchitectureDirectionPair"),W=(0,d.eW)(function([e,t],r){let i=r[0],s=r[1];return k(i)?x(s)?[e+("L"===i?-1:1),t+("T"===s?1:-1)]:[e+("L"===i?-1:1),t]:k(s)?[e+("L"===s?1:-1),t+("T"===i?1:-1)]:[e,t+("T"===i?1:-1)]},"shiftPositionByArchitectureDirectionPair"),E=(0,d.eW)(function(e){return"LT"===e||"TL"===e?[1,1]:"BL"===e||"LB"===e?[1,-1]:"BR"===e||"RB"===e?[-1,-1]:[-1,1]},"getArchitectureDirectionXYFactors"),T=(0,d.eW)(function(e){return"service"===e.type},"isArchitectureService"),L=(0,d.eW)(function(e){return"junction"===e.type},"isArchitectureJunction"),B=(0,d.eW)(e=>e.data(),"edgeData"),S=(0,d.eW)(e=>e.data(),"nodeData"),j=d.vZ.architecture,D=new n.A(()=>({nodes:{},groups:{},edges:[],registeredIds:{},config:j,dataStructures:void 0,elements:{}})),I=(0,d.eW)(()=>{D.reset(),(0,d.ZH)()},"clear"),A=(0,d.eW)(function({id:e,icon:t,in:r,title:i,iconText:s}){if(void 0!==D.records.registeredIds[e])throw Error(`The service id [${e}] is already in use by another ${D.records.registeredIds[e]}`);if(void 0!==r){if(e===r)throw Error(`The service [${e}] cannot be placed within itself`);if(void 0===D.records.registeredIds[r])throw Error(`The service [${e}]'s parent does not exist. Please make sure the parent is created before this service`);if("node"===D.records.registeredIds[r])throw Error(`The service [${e}]'s parent is not a group`)}D.records.registeredIds[e]="node",D.records.nodes[e]={id:e,type:"service",icon:t,iconText:s,title:i,edges:[],in:r}},"addService"),R=(0,d.eW)(()=>Object.values(D.records.nodes).filter(T),"getServices"),M=(0,d.eW)(function({id:e,in:t}){D.records.registeredIds[e]="node",D.records.nodes[e]={id:e,type:"junction",edges:[],in:t}},"addJunction"),O=(0,d.eW)(()=>Object.values(D.records.nodes).filter(L),"getJunctions"),P=(0,d.eW)(()=>Object.values(D.records.nodes),"getNodes"),z=(0,d.eW)(e=>D.records.nodes[e],"getNode"),Z=(0,d.eW)(function({id:e,icon:t,in:r,title:i}){if(void 0!==D.records.registeredIds[e])throw Error(`The group id [${e}] is already in use by another ${D.records.registeredIds[e]}`);if(void 0!==r){if(e===r)throw Error(`The group [${e}] cannot be placed within itself`);if(void 0===D.records.registeredIds[r])throw Error(`The group [${e}]'s parent does not exist. Please make sure the parent is created before this group`);if("node"===D.records.registeredIds[r])throw Error(`The group [${e}]'s parent is not a group`)}D.records.registeredIds[e]="group",D.records.groups[e]={id:e,icon:t,title:i,in:r}},"addGroup"),G=(0,d.eW)(()=>Object.values(D.records.groups),"getGroups"),C=(0,d.eW)(function({lhsId:e,rhsId:t,lhsDir:r,rhsDir:i,lhsInto:s,rhsInto:o,lhsGroup:n,rhsGroup:a,title:d}){if(!m(r))throw Error(`Invalid direction given for left hand side of edge ${e}--${t}. Expected (L,R,T,B) got ${r}`);if(!m(i))throw Error(`Invalid direction given for right hand side of edge ${e}--${t}. Expected (L,R,T,B) got ${i}`);if(void 0===D.records.nodes[e]&&void 0===D.records.groups[e])throw Error(`The left-hand id [${e}] does not yet exist. Please create the service/group before declaring an edge to it.`);if(void 0===D.records.nodes[t]&&void 0===D.records.groups[e])throw Error(`The right-hand id [${t}] does not yet exist. Please create the service/group before declaring an edge to it.`);let l=D.records.nodes[e].in,c=D.records.nodes[t].in;if(n&&l&&c&&l==c)throw Error(`The left-hand id [${e}] is modified to traverse the group boundary, but the edge does not pass through two groups.`);if(a&&l&&c&&l==c)throw Error(`The right-hand id [${t}] is modified to traverse the group boundary, but the edge does not pass through two groups.`);D.records.edges.push({lhsId:e,lhsDir:r,lhsInto:s,lhsGroup:n,rhsId:t,rhsDir:i,rhsInto:o,rhsGroup:a,title:d}),D.records.nodes[e]&&D.records.nodes[t]&&(D.records.nodes[e].edges.push(D.records.edges[D.records.edges.length-1]),D.records.nodes[t].edges.push(D.records.edges[D.records.edges.length-1]))},"addEdge"),Y=(0,d.eW)(()=>D.records.edges,"getEdges"),N=(0,d.eW)(()=>{if(void 0===D.records.dataStructures){let e=Object.entries(D.records.nodes).reduce((e,[t,r])=>(e[t]=r.edges.reduce((e,r)=>{if(r.lhsId===t){let t=v(r.lhsDir,r.rhsDir);t&&(e[t]=r.rhsId)}else{let t=v(r.rhsDir,r.lhsDir);t&&(e[t]=r.lhsId)}return e},{}),e),{}),t=Object.keys(e)[0],r={[t]:1},i=Object.keys(e).reduce((e,r)=>r===t?e:{...e,[r]:1},{}),s=(0,d.eW)(t=>{let s={[t]:[0,0]},o=[t];for(;o.length>0;){let t=o.shift();if(t){r[t]=1,delete i[t];let n=e[t],[a,d]=s[t];Object.entries(n).forEach(([e,t])=>{r[t]||(s[t]=W([a,d],e),o.push(t))})}}return s},"BFS"),o=[s(t)];for(;Object.keys(i).length>0;)o.push(s(Object.keys(i)[0]));D.records.dataStructures={adjList:e,spatialMaps:o}}return D.records.dataStructures},"getDataStructures"),X=(0,d.eW)((e,t)=>{D.records.elements[e]=t},"setElementForId"),J=(0,d.eW)(e=>D.records.elements[e],"getElementById"),_={clear:I,setDiagramTitle:d.g2,getDiagramTitle:d.Kr,setAccTitle:d.GN,getAccTitle:d.eu,setAccDescription:d.U$,getAccDescription:d.Mx,addService:A,getServices:R,addJunction:M,getJunctions:O,getNodes:P,getNode:z,addGroup:Z,getGroups:G,addEdge:C,getEdges:Y,setElementForId:X,getElementById:J,getDataStructures:N};function q(e){let t=(0,d.nV)().architecture;return t?.[e]?t[e]:j[e]}(0,d.eW)(q,"getConfigField");var F=(0,d.eW)((e,t)=>{(0,o.A)(e,t),e.groups.map(t.addGroup),e.services.map(e=>t.addService({...e,type:"service"})),e.junctions.map(e=>t.addJunction({...e,type:"junction"})),e.edges.map(t.addEdge)},"populateDb"),H={parse:(0,d.eW)(async e=>{let t=await (0,l.Qc)("architecture",e);d.cM.debug(t),F(t,_)},"parse")},V=(0,d.eW)(e=>`
  .edge {
    stroke-width: ${e.archEdgeWidth};
    stroke: ${e.archEdgeColor};
    fill: none;
  }

  .arrow {
    fill: ${e.archEdgeArrowColor};
  }

  .node-bkg {
    fill: none;
    stroke: ${e.archGroupBorderColor};
    stroke-width: ${e.archGroupBorderWidth};
    stroke-dasharray: 8;
  }
  .node-icon-text {
    display: flex; 
    align-items: center;
  }
  
  .node-icon-text > div {
    color: #fff;
    margin: 1px;
    height: fit-content;
    text-align: center;
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
  }
`,"getStyles"),K=(0,d.eW)(e=>`<g><rect width="80" height="80" style="fill: #087ebf; stroke-width: 0px;"/>${e}</g>`,"wrapIcon"),Q={prefix:"mermaid-architecture",height:80,width:80,icons:{database:{body:K('<path id="b" data-name="4" d="m20,57.86c0,3.94,8.95,7.14,20,7.14s20-3.2,20-7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path id="c" data-name="3" d="m20,45.95c0,3.94,8.95,7.14,20,7.14s20-3.2,20-7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path id="d" data-name="2" d="m20,34.05c0,3.94,8.95,7.14,20,7.14s20-3.2,20-7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse id="e" data-name="1" cx="40" cy="22.14" rx="20" ry="7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="20" y1="57.86" x2="20" y2="22.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="60" y1="57.86" x2="60" y2="22.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/>')},server:{body:K('<rect x="17.5" y="17.5" width="45" height="45" rx="2" ry="2" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="17.5" y1="32.5" x2="62.5" y2="32.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="17.5" y1="47.5" x2="62.5" y2="47.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><g><path d="m56.25,25c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: #fff; stroke-width: 0px;"/><path d="m56.25,25c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10;"/></g><g><path d="m56.25,40c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: #fff; stroke-width: 0px;"/><path d="m56.25,40c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10;"/></g><g><path d="m56.25,55c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: #fff; stroke-width: 0px;"/><path d="m56.25,55c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10;"/></g><g><circle cx="32.5" cy="25" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="27.5" cy="25" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="22.5" cy="25" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/></g><g><circle cx="32.5" cy="40" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="27.5" cy="40" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="22.5" cy="40" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/></g><g><circle cx="32.5" cy="55" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="27.5" cy="55" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="22.5" cy="55" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/></g>')},disk:{body:K('<rect x="20" y="15" width="40" height="50" rx="1" ry="1" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="24" cy="19.17" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="56" cy="19.17" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="24" cy="60.83" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="56" cy="60.83" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="40" cy="33.75" rx="14" ry="14.58" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="40" cy="33.75" rx="4" ry="4.17" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path d="m37.51,42.52l-4.83,13.22c-.26.71-1.1,1.02-1.76.64l-4.18-2.42c-.66-.38-.81-1.26-.33-1.84l9.01-10.8c.88-1.05,2.56-.08,2.09,1.2Z" style="fill: #fff; stroke-width: 0px;"/>')},internet:{body:K('<circle cx="40" cy="40" r="22.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="40" y1="17.5" x2="40" y2="62.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="17.5" y1="40" x2="62.5" y2="40" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path d="m39.99,17.51c-15.28,11.1-15.28,33.88,0,44.98" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path d="m40.01,17.51c15.28,11.1,15.28,33.88,0,44.98" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="19.75" y1="30.1" x2="60.25" y2="30.1" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="19.75" y1="49.9" x2="60.25" y2="49.9" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/>')},cloud:{body:K('<path d="m65,47.5c0,2.76-2.24,5-5,5H20c-2.76,0-5-2.24-5-5,0-1.87,1.03-3.51,2.56-4.36-.04-.21-.06-.42-.06-.64,0-2.6,2.48-4.74,5.65-4.97,1.65-4.51,6.34-7.76,11.85-7.76.86,0,1.69.08,2.5.23,2.09-1.57,4.69-2.5,7.5-2.5,6.1,0,11.19,4.38,12.28,10.17,2.14.56,3.72,2.51,3.72,4.83,0,.03,0,.07-.01.1,2.29.46,4.01,2.48,4.01,4.9Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/>')},unknown:i.cN,blank:{body:K("")}}},U=(0,d.eW)(async function(e,t){let r=q("padding"),i=q("iconSize"),o=i/2,n=i/6,a=n/2;await Promise.all(t.edges().map(async t=>{let{source:i,sourceDir:l,sourceArrow:c,sourceGroup:f,target:h,targetDir:p,targetArrow:y,targetGroup:m,label:$}=B(t),{x:W,y:T}=t[0].sourceEndpoint(),{x:L,y:S}=t[0].midpoint(),{x:j,y:D}=t[0].targetEndpoint(),I=r+4;if(f&&(k(l)?W+="L"===l?-I:I:T+="T"===l?-I:I+18),m&&(k(p)?j+="L"===p?-I:I:D+="T"===p?-I:I+18),f||_.getNode(i)?.type!=="junction"||(k(l)?W+="L"===l?o:-o:T+="T"===l?o:-o),m||_.getNode(h)?.type!=="junction"||(k(p)?j+="L"===p?o:-o:D+="T"===p?o:-o),t[0]._private.rscratch){let t=e.insert("g");if(t.insert("path").attr("d",`M ${W},${T} L ${L},${S} L${j},${D} `).attr("class","edge"),c){let e=k(l)?u[l](W,n):W-a,r=x(l)?u[l](T,n):T-a;t.insert("polygon").attr("points",g[l](n)).attr("transform",`translate(${e},${r})`).attr("class","arrow")}if(y){let e=k(p)?u[p](j,n):j-a,r=x(p)?u[p](D,n):D-a;t.insert("polygon").attr("points",g[p](n)).attr("transform",`translate(${e},${r})`).attr("class","arrow")}if($){let e=w(l,p)?"XY":k(l)?"X":"Y",r=0;r="X"===e?Math.abs(W-j):"Y"===e?Math.abs(T-D)/1.5:Math.abs(W-j)/2;let i=t.append("g");if(await (0,s.rw)(i,$,{useHtmlLabels:!1,width:r,classes:"architecture-service-label"},(0,d.nV)()),i.attr("dy","1em").attr("alignment-baseline","middle").attr("dominant-baseline","middle").attr("text-anchor","middle"),"X"===e)i.attr("transform","translate("+L+", "+S+")");else if("Y"===e)i.attr("transform","translate("+L+", "+S+") rotate(-90)");else if("XY"===e){let e=v(l,p);if(e&&b(e)){let t=i.node().getBoundingClientRect(),[r,s]=E(e);i.attr("dominant-baseline","auto").attr("transform",`rotate(${-1*r*s*45})`);let o=i.node().getBoundingClientRect();i.attr("transform",`
                translate(${L}, ${S-t.height/2})
                translate(${r*o.width/2}, ${s*o.height/2})
                rotate(${-1*r*s*45}, 0, ${t.height/2})
              `)}}}}}))},"drawEdges"),ee=(0,d.eW)(async function(e,t){let r=.75*q("padding"),o=q("fontSize"),n=q("iconSize")/2;await Promise.all(t.nodes().map(async t=>{let a=S(t);if("group"===a.type){let{h:l,w:c,x1:f,y1:h}=t.boundingBox();e.append("rect").attr("x",f+n).attr("y",h+n).attr("width",c).attr("height",l).attr("class","node-bkg");let p=e.append("g"),g=f,u=h;if(a.icon){let e=p.append("g");e.html(`<g>${await (0,i.s4)(a.icon,{height:r,width:r,fallbackPrefix:Q.prefix})}</g>`),e.attr("transform","translate("+(g+n+1)+", "+(u+n+1)+")"),g+=r,u+=o/2-1-2}if(a.label){let e=p.append("g");await (0,s.rw)(e,a.label,{useHtmlLabels:!1,width:c,classes:"architecture-service-label"},(0,d.nV)()),e.attr("dy","1em").attr("alignment-baseline","middle").attr("dominant-baseline","start").attr("text-anchor","start"),e.attr("transform","translate("+(g+n+4)+", "+(u+n+2)+")")}}}))},"drawGroups"),et=(0,d.eW)(async function(e,t,r){for(let o of r){let r=t.append("g"),n=q("iconSize");if(o.title){let e=r.append("g");await (0,s.rw)(e,o.title,{useHtmlLabels:!1,width:1.5*n,classes:"architecture-service-label"},(0,d.nV)()),e.attr("dy","1em").attr("alignment-baseline","middle").attr("dominant-baseline","middle").attr("text-anchor","middle"),e.attr("transform","translate("+n/2+", "+n+")")}let a=r.append("g");if(o.icon)a.html(`<g>${await (0,i.s4)(o.icon,{height:n,width:n,fallbackPrefix:Q.prefix})}</g>`);else if(o.iconText){a.html(`<g>${await (0,i.s4)("blank",{height:n,width:n,fallbackPrefix:Q.prefix})}</g>`);let e=a.append("g").append("foreignObject").attr("width",n).attr("height",n).append("div").attr("class","node-icon-text").attr("style",`height: ${n}px;`).append("div").html(o.iconText),t=parseInt(window.getComputedStyle(e.node(),null).getPropertyValue("font-size").replace(/\D/g,""))??16;e.attr("style",`-webkit-line-clamp: ${Math.floor((n-2)/t)};`)}else a.append("path").attr("class","node-bkg").attr("id","node-"+o.id).attr("d",`M0 ${n} v${-n} q0,-5 5,-5 h${n} q5,0 5,5 v${n} H0 Z`);r.attr("class","architecture-service");let{width:l,height:c}=r._groups[0][0].getBBox();o.width=l,o.height=c,e.setElementForId(o.id,r)}return 0},"drawServices"),er=(0,d.eW)(function(e,t,r){r.forEach(r=>{let i=t.append("g"),s=q("iconSize");i.append("g").append("rect").attr("id","node-"+r.id).attr("fill-opacity","0").attr("width",s).attr("height",s),i.attr("class","architecture-junction");let{width:o,height:n}=i._groups[0][0].getBBox();i.width=o,i.height=n,e.setElementForId(r.id,i)})},"drawJunctions");function ei(e,t){e.forEach(e=>{t.add({group:"nodes",data:{type:"service",id:e.id,icon:e.icon,label:e.title,parent:e.in,width:q("iconSize"),height:q("iconSize")},classes:"node-service"})})}function es(e,t){e.forEach(e=>{t.add({group:"nodes",data:{type:"junction",id:e.id,parent:e.in,width:q("iconSize"),height:q("iconSize")},classes:"node-junction"})})}function eo(e,t){t.nodes().map(t=>{let r=S(t);"group"!==r.type&&(r.x=t.position().x,r.y=t.position().y,e.getElementById(r.id).attr("transform","translate("+(r.x||0)+","+(r.y||0)+")"))})}function en(e,t){e.forEach(e=>{t.add({group:"nodes",data:{type:"group",id:e.id,icon:e.icon,label:e.title,parent:e.in},classes:"node-group"})})}function ea(e,t){e.forEach(e=>{let{lhsId:r,rhsId:i,lhsInto:s,lhsGroup:o,rhsInto:n,lhsDir:a,rhsDir:d,rhsGroup:l,title:c}=e,f=w(e.lhsDir,e.rhsDir)?"segments":"straight",h={id:`${r}-${i}`,label:c,source:r,sourceDir:a,sourceArrow:s,sourceGroup:o,sourceEndpoint:"L"===a?"0 50%":"R"===a?"100% 50%":"T"===a?"50% 0":"50% 100%",target:i,targetDir:d,targetArrow:n,targetGroup:l,targetEndpoint:"L"===d?"0 50%":"R"===d?"100% 50%":"T"===d?"50% 0":"50% 100%"};t.add({group:"edges",data:h,classes:f})})}function ed(e){let[t,r]=e.map(e=>{let t={},r={};return Object.entries(e).forEach(([e,[i,s]])=>{t[s]||(t[s]=[]),r[i]||(r[i]=[]),t[s].push(e),r[i].push(e)}),{horiz:Object.values(t).filter(e=>e.length>1),vert:Object.values(r).filter(e=>e.length>1)}}).reduce(([e,t],{horiz:r,vert:i})=>[[...e,...r],[...t,...i]],[[],[]]);return{horizontal:t,vertical:r}}function el(e){let t=[],r=(0,d.eW)(e=>`${e[0]},${e[1]}`,"posToStr"),i=(0,d.eW)(e=>e.split(",").map(e=>parseInt(e)),"strToPos");return e.forEach(e=>{let s=Object.fromEntries(Object.entries(e).map(([e,t])=>[r(t),e])),o=[r([0,0])],n={},a={L:[-1,0],R:[1,0],T:[0,1],B:[0,-1]};for(;o.length>0;){let e=o.shift();if(e){n[e]=1;let d=s[e];if(d){let l=i(e);Object.entries(a).forEach(([e,i])=>{let a=r([l[0]+i[0],l[1]+i[1]]),c=s[a];c&&!n[a]&&(o.push(a),t.push({[p[e]]:c,[p[y(e)]]:d,gap:1.5*q("iconSize")}))})}}}}),t}function ec(e,t,r,i,{spatialMaps:s}){return new Promise(o=>{let n=(0,h.Ys)("body").append("div").attr("id","cy").attr("style","display:none"),a=(0,c.Z)({container:document.getElementById("cy"),style:[{selector:"edge",style:{"curve-style":"straight",label:"data(label)","source-endpoint":"data(sourceEndpoint)","target-endpoint":"data(targetEndpoint)"}},{selector:"edge.segments",style:{"curve-style":"segments","segment-weights":"0","segment-distances":[.5],"edge-distances":"endpoints","source-endpoint":"data(sourceEndpoint)","target-endpoint":"data(targetEndpoint)"}},{selector:"node",style:{"compound-sizing-wrt-labels":"include"}},{selector:"node[label]",style:{"text-valign":"bottom","text-halign":"center","font-size":`${q("fontSize")}px`}},{selector:".node-service",style:{label:"data(label)",width:"data(width)",height:"data(height)"}},{selector:".node-junction",style:{width:"data(width)",height:"data(height)"}},{selector:".node-group",style:{padding:`${q("padding")}px`}}]});n.remove(),en(r,a),ei(e,a),es(t,a),ea(i,a);let l=ed(s),f=el(s),p=a.layout({name:"fcose",quality:"proof",styleEnabled:!1,animate:!1,nodeDimensionsIncludeLabels:!1,idealEdgeLength(e){let[t,r]=e.connectedNodes(),{parent:i}=S(t),{parent:s}=S(r);return i===s?1.5*q("iconSize"):.5*q("iconSize")},edgeElasticity(e){let[t,r]=e.connectedNodes(),{parent:i}=S(t),{parent:s}=S(r);return i===s?.45:.001},alignmentConstraint:l,relativePlacementConstraint:f});p.one("layoutstop",()=>{function e(e,t,r,i){let s,o;let{x:n,y:a}=e,{x:d,y:l}=t;o=(i-a+(n-r)*(a-l)/(n-d))/Math.sqrt(1+Math.pow((a-l)/(n-d),2)),s=Math.sqrt(Math.pow(i-a,2)+Math.pow(r-n,2)-Math.pow(o,2))/Math.sqrt(Math.pow(d-n,2)+Math.pow(l-a,2));let c=(d-n)*(i-a)-(l-a)*(r-n);switch(!0){case c>=0:c=1;break;case c<0:c=-1}let f=(d-n)*(r-n)+(l-a)*(i-a);switch(!0){case f>=0:f=1;break;case f<0:f=-1}return{distances:o=Math.abs(o)*c,weights:s*=f}}for(let t of((0,d.eW)(e,"getSegmentWeights"),a.startBatch(),Object.values(a.edges())))if(t.data?.()){let{x:r,y:i}=t.source().position(),{x:s,y:o}=t.target().position();if(r!==s&&i!==o){let r=t.sourceEndpoint(),i=t.targetEndpoint(),{sourceDir:s}=B(t),[o,n]=x(s)?[r.x,i.y]:[i.x,r.y],{weights:a,distances:d}=e(r,i,o,n);t.style("segment-distances",d),t.style("segment-weights",a)}}a.endBatch(),p.run()}),p.run(),a.ready(e=>{d.cM.info("Ready",e),o(a)})})}(0,i.ef)([{name:Q.prefix,icons:Q}]),c.Z.use(f),(0,d.eW)(ei,"addServices"),(0,d.eW)(es,"addJunctions"),(0,d.eW)(eo,"positionNodes"),(0,d.eW)(en,"addGroups"),(0,d.eW)(ea,"addEdges"),(0,d.eW)(ed,"getAlignments"),(0,d.eW)(el,"getRelativeConstraints"),(0,d.eW)(ec,"layoutArchitecture");var ef={parser:H,db:_,renderer:{draw:(0,d.eW)(async(e,t,r,i)=>{let s=i.db,o=s.getServices(),n=s.getJunctions(),l=s.getGroups(),c=s.getEdges(),f=s.getDataStructures(),h=(0,a.P)(t),p=h.append("g");p.attr("class","architecture-edges");let g=h.append("g");g.attr("class","architecture-services");let u=h.append("g");u.attr("class","architecture-groups"),await et(s,g,o),er(s,g,n);let y=await ec(o,n,l,c,f);await U(p,y),await ee(u,y),eo(s,y),(0,d.j7)(void 0,h,q("padding"),q("useMaxWidth"))},"draw")},styles:V}}}]);
//# sourceMappingURL=362.2422b211b03d4234.js.map